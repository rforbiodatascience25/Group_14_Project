---
title: "03_augment"
format: html
editor: visual
---

## Load Libraries

We start by loading the relevant libraries.

```{r}
#| message: false
library("tidyverse")
library("ggridges")
```

## Load Data

The two different datasets are loaded into the document and saved as data1 and data2. When viewing the two files, we see that they both contain ReefID_Name as the first column. This column is untidy since we have two different informations in one cell.

```{r}
#| message: false
data1 <- read_csv("../data/_raw/reef_data_dataset1.csv")
data2 <- read_csv("../data/_raw/reef_data_dataset2.csv")
```

## Data Wrangling

Starting out with the data wrangling, we want to first combine the two datasets using the join function and combining them by their common column.

```{r}
#| message: false
#| warning: false
reef_combined_untidy <- data1 |>
  left_join(data2, by = "ReefID_Name")

write_csv(reef_combined_untidy, "../data/_raw/reef_data_combined_untidy.csv")
```

Now we want to tidy the dataset, and turn ReefID_Name into two separate variables. For this we use the seperate function and split them by "\|".

```{r}
reef_combined_tidy <- reef_combined_untidy |>
  separate(
    col  = "ReefID_Name",
    into = c("Reef.ID", "Reef.Name"),
    sep  = " \\| "
  ) |>
  relocate(Reef.ID, Reef.Name, .before = 1)

write_csv(reef_combined_tidy, "../data/_raw/reef_data_combined_tidy.csv")
```

We want to check if the variable Ocean has any NA values. For this we can use the function count.

```{r}
reef_combined_tidy |>
  count(Ocean)
```

We want to remove all the observations where Ocean has NA values and we can see that 57 observations has NA values. For this we can use drop_na to remove them from the dataset.

```{r}
reef_clean <-
  reef_combined_tidy |>
  drop_na(Ocean)
```

We want to check how many observations we have for each year.

```{r}
reef_clean |>
  count(Year)
```

We see that three years (1998, 2000 and 2001) do not contain many observations. We filter them out.

```{r}
reef_clean <- reef_clean |>
  filter(Year != 1998,
         Year != 2000,
         Year != 2001)
```

## Data Analysis

Now the dataset is tidy, and we can begin analysis.

We make a plot based on the different oceans to see if any ocean stands out.

```{r}
reef_clean |>
  ggplot(aes(x = Ocean, fill = Ocean)) +
  geom_bar(colour = "black", alpha = 0.5) +
  scale_fill_viridis_d(option = "plasma") +
  labs(
    title = "Number of Observations per Ocean",
    x = "Ocean",
    y = "Count",
    fill = "Ocean"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

From the above, we see that the East Pacific has few data points. We count them:

```{r}
reef_clean |> 
  count(Ocean)
```

We conclude that the East Pacific has too few data points for further analysis when comparing to the other oceans. Hence, we filter it out.

```{r}
reef_clean <- reef_clean |>
  filter(Ocean != "East Pacific")
```

We want to add another column with the temperatures in degrees Celsius using the mutate function. This is for the following density plot.

```{r}
reef_clean <- reef_clean |>
  mutate(Temperature_Celsius = Temperature_Kelvin - 273.15)
```
