---
title: "s215037"
format: html
editor: visual
---

## Loading the raw data from the article

```{r}
#| message: false
library("tidyverse")
library("here")
```

<https://www.nature.com/articles/s41467-019-09238-2?fbclid=IwY2xjawN_yZJleHRuA2FlbQIxMABicmlkETFzTHp1YXE3Y2RndnRia2dJc3J0YwZhcHBfaWQQMjIyMDM5MTc4ODIwMDg5MgABHj9VmFya8pjkWG9U7jpt0hlLrC-tgKBYN8hdV4G2kGPdD0H9DcXHgBsaowik_aem_o13qPfw1ocf8Y00TFudYoA#data-availability>

Files:

Reef_Check_with_cortad_variables_with_annual_rate_of_SST_change.csv

Reef Check Data Raw.csv

```{r}
#| message: false
file1 <- read_csv(file = "data/_raw/Reef_Check_with_cortad_variables_with_annual_rate_of_SST_change (1).csv")
#file2 <- read_csv(file = "data/_raw/Reef Check Data Raw (1).csv")
#untidy<- read_csv(file="data/_raw/Reef_Check_Data_Untidy.csv")
```

## 

### Aim:

The aim of this project has been to tidy and combine two datasets and by doing this, be able to explore coral bleaching issues around the world. This is a collaborative project developed using Git and the workflow is also a part of the product.

### Data description

The data used in the can be accessed in the raw â€“\> data file in the Github project "Group_14_Project". The original data has been downloaded from <https://github.com/InstituteForGlobalEcology/Coral-bleaching-a-global-analysis-of-the-past-two-decades>. The specific file "Reef_Check_with_cortad_variables_with_annual_rate_of_SST_change.csv" has been the data file providing the information used for all the findings of the project. Please note that this file was already fairly tidy, and for this reason it has been untidied and split into two datasets called "reef_data_dataset1.csv" and "reef_data_dataset2.csv". This provided a better opportunity for the group to show an understanding of more functions.

The data contains many variables with names that include abbreviations. In the following list, the important ones to understand are explained:

-   SST(A): Sea Surface Temperature (Anomaly)

    -   The SST is the measured sea surface temperature in degrees Celsius for the given observation. SSTA is the degree Celsius difference compared to the normal temperature at that site (typically based on a week or month). The temperatures were derived from the *Coral Reef Temperature Anomaly Database* by the article authors.

-   TSA: Thermal Stress Anomaly

    -   TSA is the SST but with the SST maximum of a historical period subtracted. This means that the TSA is also given in degrees, and it only becomes positive if the measured SST was above the hottest week in the included climatology.

-   DHW: Degree Heating Weeks

    -   DHW is describing the cumulative thermal stress over a longer period. If DHW = 1, it means that a site was 1 degree Celsius above the warmest month at the site within long-term climatology. DHW is based on anomalies for a longer period (cumulative), whereas the SSTA and TSA are more like "snapshots" based on the anomaly at the time for the measurement.

### Experimenting with plots

##### Code from main document

```{r}
#| message: false
data1 <- read_csv(file="data/_raw/reef_data_dataset1.csv")
data2 <- read_csv(file="data/_raw/reef_data_dataset2.csv")
```

```{r}
#| message: false
reef_combined_untidy <- data1 |>
  left_join(data2, by = "ReefID_Name")

# Save the untidy version
write_csv(reef_combined_untidy, "reef_data_combined_untidy.csv")
```

```{r}
reef_combined_tidy <- reef_combined_untidy |>
  separate(
    col  = "ReefID_Name",
    into = c("Reef.ID", "Reef.Name"),
    sep  = " \\| "
  ) |>
  relocate(Reef.ID, Reef.Name, .before = 1)

# Look at the final tidy dataset
View(reef_combined_tidy)

# Save the tidy version
write_csv(reef_combined_tidy, "reef_data_combined_tidy.csv")
```

```{r}
reef_clean <-
  reef_combined_tidy |>
  drop_na(Ocean)
```

## Data Analysis

```{r}
reef_clean <- reef_clean |>
  mutate(Temperature_Celsius = Temperature_Kelvin - 273.15)
```

```{r}
library("ggridges")
ggplot(data = reef_clean,
             mapping = aes(x = Temperature_Celsius,
                           y = Ocean,
                           fill = Ocean)) +
  geom_density_ridges(alpha = 0.5) +
  scale_fill_viridis_d(option = "plasma") +
  labs(x = "Temperature_Celsius",
       y = "Ocean",
       title = "Title",
       caption = "x") +
  theme_minimal(base_family = "Avenir",
                base_size = 12) +
  theme(legend.position = "bottom")
```
