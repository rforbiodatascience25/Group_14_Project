---
title: "s215055"
format: html
editor: visual
---

## Background

Coral reefs around the world are experiencing increased stress due to rising sea-surface temperatures and other climate-driven changes. Coral bleaching is the loss of symbiotic algae from coral tissues, which is often precipitated by thermal stress. It is one of the most visible and damaging consequences of these shifts. The study by Sully et al. addresses how bleaching patterns have varied globally over recent decades.

Using field observations collected at 3,351 reef sites across 81 countries between 1998 and 2017, the authors combined these bleaching records with environmental and temperature metrics to identify spatial and temporal patterns.

Here we want to perform Data Wrangling and Data Analysis on the datasets from the study. The datasets used are described in Data Description below.

## Load Libraries

```{r}
library("tidyverse")
```

`{r} #| message: false library("tidyverse")}`

## Load Data

The two different datasets are here loaded into the document and saved as data1 and data2. When viewing the two files, we see that they both contain ReefID_Name as the first column. This column is untidy since we have two different informations in one cell.

```{r}
data1 <- read_csv(file="data/_raw/reef_data_dataset1.csv")
data2 <- read_csv(file="data/_raw/reef_data_dataset2.csv")

View(data1)
View(data2)
```

## Data Wrangling

Starting out with the data wrangling we want to first combine the two datasets using the join function and combining them by their common column.

```{r}
reef_combined_untidy_test <- data1 |>
  left_join(data2, by = "ReefID_Name")

write_csv(reef_combined_untidy, "reef_data_combined_untidy_test.csv")
```

Now we want to tidy the dataset, and turn ReefID_Name into two separate variables. For this we use the seperate function and split them by "\|".

```{r}
reef_combined_tidy_test <- reef_combined_untidy_test |>
  separate(
    col  = "ReefID_Name",
    into = c("Reef.ID", "Reef.Name"),
    sep  = " \\| "
  ) |>
  relocate(Reef.ID, Reef.Name, .before = 1)

View(reef_combined_tidy_test)

write_csv(reef_combined_tidy_test, "reef_data_combined_tidy_test.csv")
```

## Data Analysis

We want to check that the variable Ocean does not have any NA values

```{r}
reef_combined_tidy_test |>
  count(is.na(Ocean))
```

We want to remove all the observations where Ocean has NA values and we can see in the following that 57 observations has NA values.

```{r}
reef_clean <-
  reef_combined_tidy_test |>
  filter(!is.na(Ocean))

View(reef_clean)
```

```{r}
reef_clean <- reef_clean |>
  filter(Year != 1998,
         Year != 2000,
         Year != 2001)
```

```{r}
reef_clean <- reef_clean |>
  mutate(Temperature_Celsius = Temperature_Kelvin - 273.15)
```

```{r}

reef_clean |>
  ggplot(aes(x = Ocean, fill = Ocean)) +
  geom_bar(colour = "black", alpha = 0.5) +
  scale_fill_viridis_d(option = "plasma") +
  labs(
    title = "Number of Observations per Ocean",
    x = "Ocean",
    y = "Count",
    fill = "Ocean"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

During the project, we have followed the style of the "Data Science Cycle". Therefore we in

![](images/clipboard-208054861.png)

```{r}
ggplot(data_pacific_yearly,
       aes(x = Year, y = mean_bleaching)) +
       geom_col(fill = "#0D0887", alpha = 0.5, width = 0.7) +
       geom_smooth(method = "lm",
              se = FALSE,
              color = "red",
              linewidth = 1.3) +
       scale_y_continuous(limits = c(0, 7)) +
       scale_x_continuous(breaks = data_pacific_yearly$Year) +
       labs(
        x = "Year",
        y = "Mean % Bleaching",
        title = "Mean Coral Bleaching per Year (Pacific Ocean)"
        ) +
        theme_minimal(base_size = 12) +
        theme(
        axis.text.x = element_text(angle = 45, hjust = 1)
     )
```

```{r}

data_pacific_yearly |>
  ggplot(aes(x = Year, y = mean_bleaching)) +
  geom_col(fill = "#0D0887", alpha = 0.5) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red",
    linewidth = 1.3
  ) +
  scale_x_continuous(breaks = data_pacific_yearly$Year) +
  labs(
    title = "Mean Coral Bleaching per Year (Pacific Ocean)",
    x = "Year",
    y = "Mean % Bleaching"
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
